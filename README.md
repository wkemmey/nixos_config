# ‚ùÑÔ∏èBlackDonOS Powered by NixOS‚ùÑÔ∏è

A customized NixOS configuration based on [ZaneyOS](https://gitlab.com/zaney/zaneyos) by Tyler Kelley, tailored for multiple host setups with NVIDIA GPU support.

![Black Don OS Desktop](img/desktop-screenshot.png)

## Overview

Black Don OS is a personalized NixOS configuration that supports multiple host computers with different hardware profiles. It features a modern minimal desktop environment with Hyprland, extensive customization options, and easy multi-host management.

## Features

- üñ•Ô∏è **Multi-Host Support** - Easy configuration management for multiple computers
- üéÆ **NVIDIA GPU Optimized** - Full support for NVIDIA graphics with proper drivers
- üåä **Hyprland Desktop** - Modern Wayland compositor with beautiful animations
- üé® **Stylix Integration** - System-wide theming and styling
- üì¶ **Flake-based Configuration** - Reproducible and declarative system management
- üîß **Easy Host Setup** - Automated script for adding new computers
- ‚ö° **dcli Tool** - Custom CLI utility for multi-host system management

## Installation

### For New Users

If you want to install Black Don OS on a fresh NixOS system:

1. **Boot from NixOS ISO** and ensure you have network access
2. **Install git and pciutils** (for hardware detection):
   ```shell
   nix-shell -p git pciutils
   ```
3. **Run the installation script**:
   ```shell
   sh <(curl -sL https://gitlab.com/theblackdon/black-don-os/-/raw/bdos-beta-0.1/install-black-don-os.sh)
   ```

The installer will:
- Detect your hardware (GPU, etc.)
- Guide you through hostname and user configuration
- Clone the repository and set up your configuration
- Build and install Black Don OS
- Create a personalized setup for your computer

### For Existing Black Don OS Users

If you already have Black Don OS and want to add a new computer:

```shell
./setup-new-host.sh
```

This will guide you through:
- Choosing a hostname
- Selecting GPU profile (nvidia, nvidia-laptop, amd, intel, vm)
- Configuring user settings
- Creating installation guide for the new computer

### Building for a Specific Host

```bash
# Using dcli (recommended)
dcli build nix-desktop      # Build only (no activation)
dcli deploy nix-desktop     # Build and switch

# Using standard nix commands
nixos-rebuild build --flake .#nix-desktop
```

### Installing on New Hardware

1. Boot NixOS installer ISO on target computer
2. Follow the host-specific installation guide (e.g., `INSTALL-nix-desktop.md`)
3. Clone this repository and run the installation commands

## Directory Structure

```
black-don-os/
‚îú‚îÄ‚îÄ hosts/                    # Host-specific configurations
‚îÇ   ‚îú‚îÄ‚îÄ nixos-leno/          # Laptop configuration
‚îÇ   ‚îú‚îÄ‚îÄ nix-desktop/         # Desktop configuration
‚îÇ   ‚îî‚îÄ‚îÄ default/             # Template host
‚îú‚îÄ‚îÄ profiles/                 # Hardware profiles
‚îÇ   ‚îú‚îÄ‚îÄ nvidia/              # Desktop NVIDIA
‚îÇ   ‚îú‚îÄ‚îÄ nvidia-laptop/       # Laptop NVIDIA/Intel hybrid
‚îÇ   ‚îú‚îÄ‚îÄ amd/                 # AMD graphics
‚îÇ   ‚îú‚îÄ‚îÄ intel/               # Intel graphics
‚îÇ   ‚îî‚îÄ‚îÄ vm/                  # Virtual machine
‚îú‚îÄ‚îÄ modules/                  # System modules
‚îÇ   ‚îú‚îÄ‚îÄ core/                # Core system configuration
‚îÇ   ‚îú‚îÄ‚îÄ drivers/             # Hardware drivers
‚îÇ   ‚îî‚îÄ‚îÄ home/                # Home manager configuration
‚îú‚îÄ‚îÄ wallpapers/              # Desktop wallpapers
‚îú‚îÄ‚îÄ setup-new-host.sh        # New host setup script
‚îú‚îÄ‚îÄ flake.nix               # Main flake configuration
‚îî‚îÄ‚îÄ INSTALL-*.md            # Host-specific install guides
```

## Host Configuration

Each host has its own directory under `hosts/` containing:

- `default.nix` - Main host imports
- `hardware.nix` - Hardware-specific configuration (generated by nixos-generate-config)
- `variables.nix` - Host-specific settings (monitors, GPU IDs, preferences)
- `host-packages.nix` - Host-specific package list

### Key Settings in `variables.nix`

```nix
{
  # Monitor configuration (host-specific)
  extraMonitorSettings = ''
    monitor=HDMI-A-1,3440x1440@100.0,3330x1444,1.0
    monitor=eDP-1,2560x1600@165.02,6770x1558,1.33
  '';

  # GPU IDs for NVIDIA Prime
  intelID = "PCI:34:0:0";
  nvidiaID = "PCI:1:0:0";

  # Desktop preferences
  browser = "vivaldi";
  terminal = "kitty";
  stylixImage = ../../wallpapers/Valley.jpg;

  # Modular Features (enable/disable per host)
  enableNFS = true;
  printEnable = false;
  thunarEnable = true;
  controllerSupportEnable = true;
  flutterdevEnable = false;
  stylixEnable = true;
}
```

## GPU Profiles

### NVIDIA Desktop (`nvidia`)
- Dedicated NVIDIA GPU
- No hybrid graphics
- Best for gaming desktops

### NVIDIA Laptop (`nvidia-laptop`)
- NVIDIA + Intel hybrid graphics
- NVIDIA Prime support
- Power-efficient for laptops

### AMD (`amd`)
- AMD Radeon graphics
- Open-source AMDGPU drivers

### Intel (`intel`)
- Intel integrated graphics
- Lightweight and efficient

### VM (`vm`)
- Virtual machine optimized
- Minimal graphics requirements

## Installation Process

### For New Computers

1. **Boot NixOS Installer**
   ```bash
   # Download NixOS ISO and boot from USB
   ```

2. **Basic System Setup**
   ```bash
   # Partition disk, format, mount
   sudo parted /dev/nvme0n1 -- mklabel gpt
   # ... (see host-specific install guide)
   ```

3. **Clone Configuration**
   ```bash
   git clone https://gitlab.com/theblackdon/black-don-os.git
   cd black-don-os
   ```

4. **Generate Hardware Config**
   ```bash
   sudo nixos-generate-config --show-hardware-config > ./hosts/YOUR-HOST/hardware.nix
   ```

5. **Install**
   ```bash
   sudo nixos-install --flake .#YOUR-HOST
   ```

### For Existing Systems

Simply switch to a different host configuration:

```bash
# Using dcli (recommended)
dcli deploy nix-desktop

# Using interactive switcher
./switch-host.sh

# Using standard nix commands
sudo nixos-rebuild switch --flake ~/black-don-os#nix-desktop
```

## Customization

### Adding a New Host

1. Run the setup script: `./setup-new-host.sh`
2. Customize `hosts/NEW-HOST/variables.nix`
3. Test build: `nixos-rebuild build --flake .#NEW-HOST`
4. Commit changes and follow installation guide

### Updating Existing Hosts

1. Edit host-specific files in `hosts/HOST-NAME/`
2. Test changes: `dcli build HOST-NAME`
3. Apply: `dcli deploy HOST-NAME` or `dcli rebuild` (for current host)

### Adding System Packages

- Edit `modules/core/packages.nix` for system-wide packages
- Edit `hosts/HOST/host-packages.nix` for host-specific packages

### Desktop Customization

- Wallpapers: Add to `wallpapers/` and reference in `variables.nix`
- Waybar themes: Choose in `variables.nix` `waybarChoice`
- Animations: Select in `variables.nix` `animChoice`
- Colors: Stylix handles theming from wallpaper

## dcli - Don CLI Utility

Black Don OS includes `dcli`, a custom command-line utility for managing your multi-host setup:

### Common Commands
```bash
dcli help           # Show all commands
dcli list-hosts     # List available hosts
dcli rebuild        # Rebuild current host
dcli update         # Update and rebuild current host
dcli build HOST     # Build specific host (no activation)
dcli deploy HOST    # Deploy to specific host
dcli cleanup        # Clean old generations
dcli switch-host    # Interactive host switcher
```

### Shell Aliases
- `fr` - Fast rebuild (`dcli rebuild`)
- `fu` - Fast update (`dcli update`)
- `hosts` - List hosts (`dcli list-hosts`)
- `switch` - Host switcher (`dcli switch-host`)

See [dcli.md](dcli.md) for complete documentation.

## Development

### Repository Management

This is a fork of ZaneyOS with personal customizations:

- **Origin**: Your fork at https://gitlab.com/theblackdon/black-don-os.git
- **Upstream**: Original ZaneyOS at https://gitlab.com/zaney/zaneyos.git

### Updating from Upstream

```bash
# Fetch updates from original ZaneyOS
dcli pull           # Pull from your fork
git fetch upstream  # Fetch from original ZaneyOS

# Merge updates (be careful with conflicts)
git merge upstream/stable-2.3
```

### Contributing Changes

1. Make changes in feature branch
2. Test on multiple hosts: `dcli build HOST-NAME`
3. Update documentation
4. Commit and push: `dcli commit "message"` && `dcli push`

## Troubleshooting

### Build Failures

```bash
# Generate diagnostic report
dcli diag

# Show detailed error trace
nixos-rebuild build --flake .#HOST-NAME --show-trace

# Clean build cache
dcli cleanup
```

### Hardware Detection

```bash
# Find GPU IDs for NVIDIA Prime
lspci | grep VGA

# Generate new hardware config
sudo nixos-generate-config --show-hardware-config
```

### Monitor Configuration

```bash
# List available outputs
hyprctl monitors

# Test monitor setup
hyprctl keyword monitor "HDMI-A-1,1920x1080@60,0x0,1"
```

## Credits

- **ZaneyOS**: Original configuration by Tyler Kelley
- **NixOS**: The foundation of this configuration
- **Hyprland**: Wayland compositor
- **Stylix**: System theming
- **Home Manager**: User environment management

## License

Based on ZaneyOS, following the same license terms. See [LICENSE](LICENSE) file for details.

## Support

For issues specific to Black Don OS customizations:
- Check host-specific installation guides
- Review the troubleshooting section
- Refer to the original ZaneyOS documentation for base functionality

---

*Happy computing with Black Don OS! üöÄ*
